
#$Id: Makefile.0,v 1.3 1992/10/02 14:39:29 berg Exp $

PM_OBJ=cstdio.$(O) common.$(O) exopen.$(O) goodies.$(O) locking.$(O) \
 mailfold.$(O) misc.$(O) pipes.$(O) regexp.$(O) robust.$(O) sublib.$(O)
LF_OBJ=exopen.$(O) sublib.$(O)
FM_OBJ=common.$(O) fields.$(O) formisc.$(O) sublib.$(O)

all:	$(BINSS)

make:
	@$(SHELL) -c "exit 0"

procmail: procmail.$(O) $(PM_OBJ)
	$(CC) $(CFLAGS) $@.$(O) $(PM_OBJ) -o $@ $(LDFLAGS)

lockfile: lockfile.$(O) $(LF_OBJ)
	$(CC) $(CFLAGS) $@.$(O) $(LF_OBJ) -o $@ $(LDFLAGS)

formail: formail.$(O) $(FM_OBJ)
	$(CC) $(CFLAGS) $@.$(O) $(FM_OBJ) -o $@ $(LDFLAGS)

mailstat: ../examples/mailstat
	cp ../examples/$@ .
	chmod 0755 $@

multigram: multrigram.$(O) sublib.$(O)
	$(CC) $(CFLAGS) $@.$(O) sublib.$(O) -o $@ $(LDFLAGS)

../new:
	@-mkdir $@ 2>$(DEVNULL); exit 0

_autotst: _autotst.$(O)
	$(CC) $(CFLAGS) $@.$(O) -o $@ $(LDFLAGS)

# to fully support "make -n"
HIDEMAKE = $(MAKE)

../autoconf.h: autoconf Makefile
	$(SHELL) ./autoconf $(SHELL) "$(RM)" $(USRINCLUDE) $(DEVNULL) \
	 "$(FGREP)" "$(HIDEMAKE)" $(O) $@

autoconf.h: ../autoconf.h

common.$(O): procmail.h robust.h shell.h misc.h common.h

cstdio.$(O): procmail.h robust.h cstdio.h misc.h

exopen.$(O): procmail.h robust.h misc.h exopen.h

fields.$(O): includes.h formail.h sublib.h shell.h common.h fields.h formisc.h

formail.$(O): includes.h formail.h sublib.h common.h fields.h formisc.h
formail.$(O): header.h shell.h

formisc.$(O): includes.h formail.h sublib.h common.h formisc.h shell.h

goodies.$(O): procmail.h sublib.h robust.h shell.h misc.h pipes.h common.h
goodies.$(O): cstdio.h goodies.h

lockfile.$(O): includes.h sublib.h exopen.h robust.h misc.h

locking.$(O): procmail.h robust.h shell.h misc.h exopen.h locking.h

mailfold.$(O): procmail.h sublib.h robust.h shell.h misc.h pipes.h common.h
mailfold.$(O): exopen.h locking.h mailfold.h network.h

manconf.$(O): ../patchlevel.h procmail.h

misc.$(O): procmail.h sublib.h robust.h shell.h misc.h pipes.h common.h
misc.$(O): cstdio.h exopen.h regexp.h goodies.h locking.h mailfold.h

pipes.$(O): procmail.h robust.h shell.h misc.h pipes.h common.h cstdio.h
pipes.$(O): goodies.h mailfold.h

procmail.$(O): ../patchlevel.h procmail.h sublib.h robust.h shell.h misc.h
procmail.$(O): pipes.h common.h cstdio.h exopen.h goodies.h locking.h
procmail.$(O): mailfold.h

regexp.$(O): procmail.h robust.h shell.h regexp.h

robust.$(O): procmail.h robust.h shell.h misc.h mailfold.h shell.h

sublib.$(O): includes.h sublib.h shell.h

recommend.$(O): includes.h
	@$(CC) -c $(CFLAGS) $*.c

procmail.h: includes.h
	touch $@

includes.h: ../autoconf.h ../config.h
	touch $@

.c.$(O):
	$(CC) -c $(CFLAGS) $<

recommend: recommend.$(O) sublib.$(O)
	@$(CC) $(CFLAGS) $@.$(O) sublib.$(O) -o $@ $(LDFLAGS)

../man/man.sed: manconf.c procmail.h ../patchlevel.h
	$(CC) $(CFLAGS) -o _autotst manconf.c $(LDFLAGS)
	./_autotst >$@
	$(RM) _autotst

clean:
	$(RM) procmail.$(O) $(PM_OBJ) lockfile.$(O) $(LF_OBJ) formail.$O \
	 $(FM_OBJ) $(BINSS) ../autoconf.h _autotst* lookfor _locktst* \
	 grepfor recommend recommend.$(O) manconf _Makefile core

Makefile: ../Makefile Makefile.0
	@echo "You have made changes to the master Makefile, in order for"
	@echo "these changes to show through, you will have to do first:"
	@echo "$(MAKE) makefiles"

makefiles Makefiles makefile:
	cd ..; $(MAKE) makefiles

init:
	cd ..; $(MAKE) $@
