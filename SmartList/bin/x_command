#! /bin/sh
: &&O= || exec /bin/sh $0 $argv:q # we're in a csh, feed myself to sh
#$Id: x_command,v 1.4 1993/01/15 16:06:01 berg Exp $

echo=echo		# /bin/echo
test=test		# /bin/test
cat=cat			# /bin/cat
formail=formail		# /usr/local/bin/formail
subscribe=subscribe	# ../.bin/subscribe
unsubscribe=unsubscribe # ../.bin/unsubscribe

tmprequest=tmp.request
tmpfrom=tmp.from
dist=dist
log=log

$test -z "$listaddr" &&
 $echo "Don't start this script directly, it is used in rc.request" && exit 64

$formail -R$X_COMMAND: X-Processed:

while $test $# != 0
do
  case "_$1" in
     _subscribe)
	 $echo "From $2 " >$tmprequest
	 $echo "From: $listreq" >>$tmprequest
	 $echo "Reply-To: $2" >>$tmprequest
	 $echo "To: $listreq" >>$tmprequest
	 $echo "Subject: subscribe $2" >>$tmprequest
	 $echo "$2" >$tmpfrom
	 $subscribe <$tmprequest | $SENDMAIL $sendmailOPT -t
	 shift ;;
     _unsubscribe)
	 $echo "From $2 " >$tmprequest
	 $echo "From: $listreq" >>$tmprequest
	 $echo "Reply-To: $2" >>$tmprequest
	 $echo "To: $listreq" >>$tmprequest
	 $echo "Subject: unsubscribe $2" >>$tmprequest
	 $echo "$maintainer" "$2" >$tmpfrom
	 $unsubscribe <$tmprequest | $SENDMAIL $sendmailOPT `cat $tmpfrom`
	 shift ;;
     _showdist)
	 $echo "--- Current subscribers:"
	 $cat $dist
	 $echo "--- End of subscriber list" ;;
     _showlog)
	 $echo "--- Current log:"
	 $cat $log
	 $echo "--- End of log" ;;
     _wipelog)
	 $cat /dev/null >$log ;;
     _help|_info)
	 $echo "Known $X_COMMAND keywords:"
	 $echo "	subscribe mailaddress"
	 $echo "	unsubscribe mailaddress"
	 $echo "	showdist"
	 $echo "	showlog"
	 $echo "	wipelog"
	 $echo "	help"
	 $echo "	info" ;;
     _$X_COMMAND_PASSWORD|_$maintainer) ;;
     *) $echo "X-Diagnostic: Unknown command $1" ; set dummy help ;;
  esac
  shift
done
