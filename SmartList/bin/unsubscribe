#! /bin/sh
: &&O= || exec /bin/sh $0 $argv:q # we're in a csh, feed myself to sh
#$Id: unsubscribe,v 1.4 1993/01/15 14:40:52 berg Exp $

test=test		# /bin/test
echo=echo		# /bin/echo
cat=cat			# /bin/cat
sed=sed			# /bin/sed
formail=formail		# /usr/local/bin/formail
multigram=multigram	# ../.bin/multigram

$test -z "$listaddr" &&
 $echo "Don't start this script directly, it is used in rc.request" && exit 64

tmprequest=tmp.request
tmpfrom=tmp.from
dist=dist

$formail -i"Sender: $listreq" -i"From: $listaddr" -rtA"X-Loop: $listaddr" \
 <$tmprequest

fromaddr="`$cat $tmpfrom`"

if $multigram -b1 -l$off_threshold -d $dist 2>/dev/null
then
  $echo
  $echo "You have been removed from the list."
else
  $echo "You have not been removed, I couldn't find your name on the list."
fi |
 $sed -e '1 s/^ *[0-9]* [^ ]* \(.*\)$/\1/' \
  -e '2 s/^Removed: \(.*\)$/\1/w '$tmpfrom

$echo "$fromaddr" >>$tmpfrom

$echo
$echo "Transcript of unsubscription request follows:"
$echo

$sed -e 's/^\(.\)/>\1/' $tmprequest
